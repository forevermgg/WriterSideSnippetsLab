# ELF-GOT
ELF将GOT拆分成了两个表叫做“.got”和“.got.plt”。其中“.got”用来保存全局变量引用的地址，“.got.plt”用来保存函数引用的地址，即把外部函数的引用分离到“.got.plt”中。另外“.got.plt”的前三项是有特殊意义的：

+ 第一项保存的是“.dynamic”段的地址，这个段描述了本模块动态链接相关的信息
+ 第二项保存的是本模块的ID。
+ 第三项保存的是_dl_runtime_resolve()的地址。

## 全局偏移表（Global Offset Table，GOT）

全局偏移表（Global Offset Table，GOT）是用于支持位置无关代码（Position Independent Code，PIC）的一种数据结构。GOT 主要用于动态链接库（如 .so 文件）和共享库中，以解决全局变量和函数地址的引用问题。

在动态链接库中，全局变量和函数的实际地址在编译时是未知的，因为库可以在程序运行时被加载到任意内存地址。为了解决这个问题，编译器和链接器会使用相对地址（而不是绝对地址）来引用全局变量和函数。这些相对地址是相对于库在内存中的基地址（Base Address）的偏移量。

全局偏移表（GOT）就是用于存储这些相对地址的数据结构。每个动态链接库和共享库都有一个 GOT。在程序运行时，动态链接器（如 ld.so）会根据库的实际加载地址计算全局变量和函数的绝对地址，并将这些地址填充到 GOT 中。然后，库中的代码可以通过访问 GOT 来间接引用全局变量和函数。

GOT 的主要优点是它允许动态链接库和共享库在不同程序中共享相同的代码段（Text Segment）。这是因为库中的代码可以在不同的内存地址运行，而不需要对代码进行重定位。这样可以节省内存并减少程序启动时间。

总结一下，全局偏移表（GOT）是一种用于支持位置无关代码（PIC）的数据结构，它存储了动态链接库和共享库中全局变量和函数的相对地址。在程序运行时，动态链接器会根据库的实际加载地址填充 GOT，以便库中的代码可以间接引用全局变量和函数。

### GOT如何做到指令的地址无关性？
GOT（全局偏移表）通过间接寻址实现了指令的地址无关性。以下是GOT如何做到地址无关性的详细解释：

+ 编译和链接：在编译和链接阶段，编译器和链接器会为位置无关代码（PIC）生成特殊的指令序列来访问全局变量和函数。这些指令序列使用相对于库基地址（Base Address）的偏移量（而不是绝对地址）来引用全局变量和函数。这些偏移量在GOT（全局偏移表）中存储。

+ 间接寻址：GOT中的条目包含全局变量和函数的地址。程序中的代码不直接引用这些地址，而是通过GOT进行间接寻址。这意味着，只要GOT中的地址得到正确填充，程序中的代码就可以在任意内存地址运行，而不需要进行重定位。

+ 动态链接器：在程序运行时，动态链接器（如ld.so）负责将库加载到内存并计算库的实际基地址。然后，动态链接器根据库的基地址和GOT中的偏移量计算全局变量和函数的实际地址，并将这些地址填充到GOT中。

+ 运行时访问：当程序运行时，代码通过访问GOT中的地址来间接引用全局变量和函数。由于GOT已经根据库的实际加载地址进行了填充，所以代码可以在不同的内存地址运行，而不受影响。

通过这种方式，GOT实现了指令的地址无关性。它允许动态链接库和共享库在不同程序中共享相同的代码段（Text Segment），从而节省内存并减少程序启动时间。

### GOT和PLT之前的区别

GOT（全局偏移表，Global Offset Table）和 PLT（过程链接表，Procedure Linkage Table）都是用于支持位置无关代码（Position Independent Code，PIC）的数据结构，它们在动态链接库和共享库中起到重要作用。尽管它们有一定的关联，但它们的主要目的和用途有所不同。

GOT（全局偏移表）：

GOT 是一种用于存储全局变量和函数地址的数据结构。它允许动态链接库和共享库在运行时解析全局变量和函数的实际地址，而无需对代码进行重定位。GOT 的主要作用是实现全局变量和函数的地址无关性，使得库中的代码可以在不同的内存地址运行。

PLT（过程链接表）：

PLT 是一种用于实现懒加载（Lazy Binding）的数据结构。懒加载是一种运行时链接技术，它允许程序在调用外部函数时才解析这些函数的实际地址。PLT 包含了一系列跳转指令，这些指令会在第一次调用外部函数时触发动态链接器（如 ld.so）来解析函数的实际地址，并将地址填充到 GOT 中。在后续的函数调用中，程序会直接跳转到 GOT 中的地址，无需再次进行地址解析。

总结一下，GOT 和 PLT 都是用于支持位置无关代码的数据结构，但它们的主要目的和用途有所不同。GOT 用于存储全局变量和函数的地址，实现地址无关性；而 PLT 用于实现懒加载，允许程序在调用外部函数时才解析这些函数的实际地址。在动态链接库和共享库中，这两个数据结构通常会一起使用，以实现高效的运行时链接和地址解析。